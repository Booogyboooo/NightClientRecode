package io.booogyboooo.nightclient.modules.exploit;

import java.util.List;
import java.util.Optional;

import io.booogyboooo.nightclient.module.NightModule;
import io.booogyboooo.nightclient.module.Type;
import it.unimi.dsi.fastutil.ints.Int2ObjectMaps;
import net.minecraft.item.Items;
import net.minecraft.network.packet.c2s.play.BookUpdateC2SPacket;
import net.minecraft.network.packet.c2s.play.ClickSlotC2SPacket;
import net.minecraft.screen.slot.SlotActionType;
import net.minecraft.screen.sync.ItemStackHash;
import net.minecraft.text.Text;
import net.minecraft.util.Formatting;

public class BookDupe extends NightModule {

	public BookDupe() {
		super(Type.EXPLOIT, "BookDupe", "Default");
	}
	
	@Override
	public void onEnable() {
		if (mc.player == null) {
			return;
		}
		if (!(mc.player.getInventory().getSelectedStack().getItem() == Items.WRITABLE_BOOK)) {
			mc.player.sendMessage(Text.literal("[BookDupe]").formatted(Formatting.BLACK).append(Text.literal(" You need to hold a book and quill").formatted(Formatting.GRAY)), false);
		}
		
        for (int i = 9; i < 44; i++) {
            if (36 + mc.player.getInventory().getSelectedSlot() == i) {
            	continue;
            }
            mc.player.networkHandler.sendPacket(new ClickSlotC2SPacket(mc.player.currentScreenHandler.syncId, mc.player.currentScreenHandler.getRevision(), (short) i, (byte) 1, SlotActionType.THROW, Int2ObjectMaps.singleton(0, ItemStackHash.EMPTY), ItemStackHash.EMPTY));
        }
        
        mc.player.networkHandler.sendPacket(new BookUpdateC2SPacket(mc.player.getInventory().getSelectedSlot(), List.of("BookDupe: Failed to dupe. Is it patched?"), Optional.of("BookDupe: Failed to dupe. Is it patched?")));
        this.toggle(false);
	}

}
